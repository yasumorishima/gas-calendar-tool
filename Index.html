<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>GASã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²ãƒ„ãƒ¼ãƒ«</title>
  <style>
    /* å®Œå…¨ãƒªã‚»ãƒƒãƒˆ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
      line-height: 1.6;
      background: white;
    }

    /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ã®èƒŒæ™¯ã¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 1025px) {
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 32px;
      }
      
      .container {
        max-width: 700px;
        margin: 0 auto;
        background: white;
        border-radius: 24px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
      
      .content {
        padding: 36px 40px 44px;
      }
      
      .header {
        padding: 32px 24px;
      }
      
      .calendar-day:hover {
        background: #f0f0f0;
        transform: translateY(-2px);
      }
      
      .calendar-day.selected:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }
      
      .btn:hover {
        transform: translateY(-2px);
      }
    }

    /* ãƒ¢ãƒã‚¤ãƒ«ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆå°‚ç”¨ - ç”»é¢ã„ã£ã±ã„ */
    @media (max-width: 1024px) {
      html, body {
        overflow-x: hidden;
      }
      
      .container {
        width: 100vw;
        max-width: 100vw;
        margin: 0;
        padding: 0;
      }
      
      .content {
        padding: 20px 16px 24px 16px;
      }
      
      .header {
        padding: 24px 16px;
      }
      
      .header h1 {
        font-size: 36px !important;
        padding: 0;
        font-weight: 800 !important;
      }
      
      .header p {
        font-size: 22px !important;
        padding: 0;
      }
      
      .form-label {
        font-size: 28px !important;
        padding: 0;
        font-weight: 800 !important;
      }
      
      .form-sublabel {
        font-size: 22px !important;
        padding: 0;
      }
      
      .form-input,
      .form-select {
        font-size: 28px !important;
        min-height: 80px !important;
        padding: 26px 16px !important;
        border-radius: 12px !important;
      }
      
      .form-select {
        padding-right: 60px !important;
        background-size: 44px !important;
        background-position: right 16px center !important;
      }
      
      .calendar-wrapper {
        padding: 12px 16px !important;
        border-radius: 12px !important;
      }
      
      .calendar-header {
        font-size: 20px !important;
        font-weight: 800 !important;
      }
      
      .calendar-grid {
        gap: 8px !important;
      }
      
      .calendar-day {
        font-size: 26px !important;
        min-height: 76px !important;
        font-weight: 800 !important;
        border-radius: 12px !important;
        border-width: 3px !important;
      }
      
      .radio-label {
        font-size: 28px !important;
        min-height: 80px !important;
        padding: 26px 12px !important;
        border-radius: 12px !important;
        font-weight: 700 !important;
      }
      
      .radio-group {
        gap: 10px !important;
      }
      
      .btn {
        font-size: 28px !important;
        min-height: 84px !important;
        padding: 28px 12px !important;
        font-weight: 800 !important;
        border-radius: 12px !important;
      }
      
      .button-group {
        gap: 10px !important;
      }
      
      .time-input-group label {
        font-size: 22px !important;
        padding: 0;
        font-weight: 700 !important;
      }
      
      .time-inputs {
        grid-template-columns: 1fr !important;
        gap: 16px !important;
      }
      
      .event-list {
        padding: 18px 16px !important;
        border-radius: 12px !important;
      }
      
      .event-list-header {
        font-size: 28px !important;
        font-weight: 800 !important;
      }
      
      .event-name {
        font-size: 24px !important;
        font-weight: 800 !important;
      }
      
      .event-details {
        font-size: 20px !important;
      }
      
      .event-item {
        padding: 20px 16px !important;
        border-radius: 12px !important;
      }
      
      .btn-delete {
        font-size: 22px !important;
        min-height: 72px !important;
        font-weight: 800 !important;
        border-radius: 12px !important;
        padding: 16px 20px !important;
      }
      
      .message {
        font-size: 22px !important;
        padding: 24px 16px !important;
        border-radius: 12px !important;
      }
      
      .info-box {
        padding: 20px 16px !important;
        border-radius: 12px !important;
      }
      
      .info-box p {
        font-size: 22px !important;
      }
      
      .form-section {
        margin-bottom: 32px !important;
      }
      
      .section-divider {
        margin: 28px 0 !important;
      }
      
      .scrollable-list p {
        font-size: 22px !important;
      }
    }

    .container {
      background: white;
      overflow: hidden;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
    }

    .header h1 {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .header p {
      font-size: 15px;
      opacity: 0.95;
    }

    .form-section {
      margin-bottom: 32px;
    }

    .form-label {
      display: block;
      font-size: 17px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 12px;
    }

    .form-sublabel {
      display: block;
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 18px 20px;
      font-size: 17px;
      border: 2px solid #e5e5e5;
      border-radius: 16px;
      transition: all 0.3s;
      background: white;
      color: #1a1a1a;
      appearance: none;
      -webkit-appearance: none;
      min-height: 60px;
    }

    .form-select {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23667eea' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      background-size: 24px;
      padding-right: 50px;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      transform: translateY(-1px);
    }

    .calendar-wrapper {
      background: #f8f9fa;
      padding: 16px;
      border-radius: 16px;
      margin-top: 12px;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }

    .calendar-header {
      text-align: center;
      font-size: 14px;
      font-weight: 700;
      color: #555;
      padding: 12px 4px;
      background: #e9ecef;
      border-radius: 10px;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      font-weight: 600;
      border: 3px solid #e5e5e5;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
      min-height: 56px;
      color: #1a1a1a;
    }

    .calendar-day:active {
      transform: scale(0.92);
    }

    .calendar-day.selected {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .radio-group {
      display: flex;
      gap: 12px;
    }

    .radio-option {
      flex: 1;
    }

    .radio-option input[type="radio"] {
      display: none;
    }

    .radio-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px 24px;
      border: 3px solid #e5e5e5;
      border-radius: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 17px;
      font-weight: 600;
      min-height: 60px;
    }

    .radio-option input[type="radio"]:checked + .radio-label {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .radio-label:active {
      transform: scale(0.97);
    }

    .time-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .time-input-group label {
      font-size: 15px;
      font-weight: 600;
      color: #444;
      margin-bottom: 10px;
      display: block;
    }

    .button-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 32px;
    }

    .btn {
      padding: 20px 28px;
      font-size: 18px;
      font-weight: 700;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s;
      min-height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn:active {
      transform: translateY(2px);
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #ff4757;
      color: white;
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.3);
    }

    .btn-tertiary {
      background: #f8f9fa;
      color: #444;
      border: 2px solid #e5e5e5;
    }

    .btn-success {
      background: linear-gradient(135deg, #26de81 0%, #20bf6b 100%);
      color: white;
      box-shadow: 0 6px 20px rgba(38, 222, 129, 0.3);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-full {
      width: 100%;
      grid-column: 1 / -1;
    }

    .message {
      padding: 18px 20px;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      margin-top: 24px;
    }

    .message-success {
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }

    .message-error {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }

    .hidden {
      display: none;
    }

    .event-list {
      margin-top: 32px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 16px;
    }

    .event-list-header {
      font-size: 19px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 16px;
    }

    .event-item {
      background: white;
      padding: 18px 20px;
      border-radius: 14px;
      margin-bottom: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
      gap: 12px;
    }

    .event-info {
      flex: 1;
      min-width: 0;
    }

    .event-name {
      font-size: 17px;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 6px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .event-details {
      font-size: 14px;
      color: #666;
    }

    .btn-delete {
      background: #ff4757;
      color: white;
      padding: 14px 20px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      border: none;
      cursor: pointer;
      min-width: 80px;
      min-height: 52px;
      flex-shrink: 0;
    }

    .btn-delete:active {
      transform: scale(0.95);
    }

    .section-divider {
      border-top: 3px solid #e9ecef;
      margin: 36px 0;
    }

    .info-box {
      background: #e7f3ff;
      border: 2px solid #b3d9ff;
      border-radius: 14px;
      padding: 16px 20px;
      margin-bottom: 16px;
    }

    .info-box p {
      font-size: 15px;
      color: #004085;
      line-height: 1.6;
    }

    .scrollable-list {
      max-height: 400px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²</h1>
      <p>ç°¡å˜ã«Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¸ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ </p>
    </div>

    <div class="content">
      <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ID -->
      <div class="form-section">
        <label class="form-label">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ID</label>
        <input type="email" id="calendarId" class="form-input" placeholder="your_email@gmail.com">
      </div>

      <!-- æœˆé¸æŠ -->
      <div class="form-section">
        <label class="form-label">æœˆã‚’é¸æŠ</label>
        <input type="month" id="month" class="form-input">
      </div>

      <!-- æ—¥ä»˜é¸æŠ -->
      <div class="form-section">
        <label class="form-label">æ—¥ä»˜ã‚’é¸æŠ</label>
        <div class="calendar-wrapper">
          <div id="dayGrid" class="calendar-grid"></div>
          <button id="selectAllDays" class="btn btn-tertiary btn-full">å…¨é¸æŠ / è§£é™¤</button>
        </div>
      </div>

      <!-- ã‚¤ãƒ™ãƒ³ãƒˆå -->
      <div class="form-section">
        <label class="form-label">ã‚¤ãƒ™ãƒ³ãƒˆå</label>
        <input type="text" id="eventTitle" class="form-input" placeholder="ä¾‹: ä¼šè­°ã€èª•ç”Ÿæ—¥">
      </div>

      <!-- ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ— -->
      <div class="form-section">
        <label class="form-label">ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—</label>
        <div class="radio-group">
          <div class="radio-option">
            <input type="radio" name="eventType" value="allDay" id="eventTypeAllDay" checked>
            <label for="eventTypeAllDay" class="radio-label">çµ‚æ—¥</label>
          </div>
          <div class="radio-option">
            <input type="radio" name="eventType" value="timed" id="eventTypeTimed">
            <label for="eventTypeTimed" class="radio-label">æ™‚é–“æŒ‡å®š</label>
          </div>
        </div>
      </div>

      <!-- æ™‚é–“æŒ‡å®š -->
      <div id="timeInputs" class="form-section" style="display: none;">
        <div class="time-inputs">
          <div class="time-input-group">
            <label>é–‹å§‹æ™‚é–“</label>
            <input type="time" id="startTime" class="form-input" value="09:00">
          </div>
          <div class="time-input-group">
            <label>çµ‚äº†æ™‚é–“</label>
            <input type="time" id="endTime" class="form-input" value="17:00">
          </div>
        </div>
      </div>

      <!-- ã‚¤ãƒ™ãƒ³ãƒˆè‰² -->
      <div class="form-section">
        <label class="form-label">ã‚¤ãƒ™ãƒ³ãƒˆã®è‰²</label>
        <select id="eventColor" class="form-select">
          <option value="">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</option>
          <option value="LAVENDER">ğŸŸ£ ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼</option>
          <option value="SAGE">ğŸŸ¢ ã‚»ãƒ¼ã‚¸</option>
          <option value="PURPLE">ğŸŸ£ ãƒ–ãƒ‰ã‚¦</option>
          <option value="PINK">ğŸ©· ãƒ•ãƒ©ãƒŸãƒ³ã‚´</option>
          <option value="YELLOW">ğŸŸ¡ ãƒãƒŠãƒŠ</option>
          <option value="ORANGE">ğŸŸ  ãƒŸã‚«ãƒ³</option>
          <option value="CYAN">ğŸ”µ ãƒ”ãƒ¼ã‚³ãƒƒã‚¯</option>
          <option value="GREY">âšª ã‚°ãƒ©ãƒ•ã‚¡ã‚¤ãƒˆ</option>
          <option value="BLUE">ğŸ”µ ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼</option>
          <option value="GREEN">ğŸŸ¢ ãƒã‚¸ãƒ«</option>
          <option value="RED">ğŸ”´ ãƒˆãƒãƒˆ</option>
        </select>
      </div>

      <!-- ç™»éŒ²ãƒ»ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ -->
      <div class="button-group">
        <button id="addEventButton" class="btn btn-primary">ğŸ“ ç™»éŒ²</button>
        <button id="clearInputs" class="btn btn-secondary">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
      </div>

      <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ -->
      <div id="messageArea" class="hidden"></div>

      <div class="section-divider"></div>

      <!-- ä¿å­˜æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆé¸æŠ -->
      <div class="form-section">
        <label class="form-label">ä¿å­˜æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆã‚’é¸æŠ</label>
        <p class="form-sublabel">éå»ã«ä¿å­˜ã—ãŸã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šã‚’èª­ã¿è¾¼ã‚ã¾ã™</p>
        <select id="selectSavedEventName" class="form-select">
          <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
        </select>
      </div>

      <div class="section-divider"></div>

      <!-- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒˆ -->
      <div class="event-list">
        <div class="event-list-header">ğŸ’¾ ä¿å­˜æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆ</div>
        <div id="eventNamesList" class="scrollable-list">
          <p style="color: #666; font-size: 15px;">èª­ã¿è¾¼ã¿ä¸­...</p>
        </div>
      </div>

      <!-- æ–°è¦ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ  -->
      <div class="form-section" style="margin-top: 32px;">
        <label class="form-label">æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜</label>
        <p class="form-sublabel">ã‚ˆãä½¿ã†ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šã‚’ä¿å­˜ã—ã¦ãŠã‘ã¾ã™</p>
        
        <div style="margin-bottom: 16px;">
          <input type="text" id="newEventNameInput" class="form-input" placeholder="ã‚¤ãƒ™ãƒ³ãƒˆåã‚’å…¥åŠ›">
        </div>

        <div style="margin-bottom: 16px;">
          <label class="form-label" style="font-size: 15px; margin-bottom: 10px;">ã‚¿ã‚¤ãƒ—</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" name="newEventEventType" value="allDay" id="newEventEventTypeAllDay" checked>
              <label for="newEventEventTypeAllDay" class="radio-label">çµ‚æ—¥</label>
            </div>
            <div class="radio-option">
              <input type="radio" name="newEventEventType" value="timed" id="newEventEventTypeTimed">
              <label for="newEventEventTypeTimed" class="radio-label">æ™‚é–“æŒ‡å®š</label>
            </div>
          </div>
        </div>

        <div id="newEventNameInputs" class="time-inputs" style="display: none; margin-bottom: 16px;">
          <div class="time-input-group">
            <label>é–‹å§‹æ™‚é–“</label>
            <input type="time" id="newStartTime" class="form-input" value="09:00">
          </div>
          <div class="time-input-group">
            <label>çµ‚äº†æ™‚é–“</label>
            <input type="time" id="newEndTime" class="form-input" value="17:00">
          </div>
        </div>

        <div style="margin-bottom: 16px;">
          <label class="form-label" style="font-size: 15px; margin-bottom: 10px;">è‰²</label>
          <select id="newEventColor" class="form-select">
            <option value="">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</option>
            <option value="LAVENDER">ğŸŸ£ ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼</option>
            <option value="SAGE">ğŸŸ¢ ã‚»ãƒ¼ã‚¸</option>
            <option value="PURPLE">ğŸŸ£ ãƒ–ãƒ‰ã‚¦</option>
            <option value="PINK">ğŸ©· ãƒ•ãƒ©ãƒŸãƒ³ã‚´</option>
            <option value="YELLOW">ğŸŸ¡ ãƒãƒŠãƒŠ</option>
            <option value="ORANGE">ğŸŸ  ãƒŸã‚«ãƒ³</option>
            <option value="CYAN">ğŸ”µ ãƒ”ãƒ¼ã‚³ãƒƒã‚¯</option>
            <option value="GREY">âšª ã‚°ãƒ©ãƒ•ã‚¡ã‚¤ãƒˆ</option>
            <option value="BLUE">ğŸ”µ ãƒ–ãƒ«ãƒ¼ãƒ™ãƒªãƒ¼</option>
            <option value="GREEN">ğŸŸ¢ ãƒã‚¸ãƒ«</option>
            <option value="RED">ğŸ”´ ãƒˆãƒãƒˆ</option>
          </select>
        </div>

        <button id="addEventNameButton" class="btn btn-success btn-full">âœ… ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const calendarIdInput = document.getElementById('calendarId');
      const monthInput = document.getElementById('month');
      const dayGridDiv = document.getElementById('dayGrid');
      const selectAllDaysButton = document.getElementById('selectAllDays');
      const eventTitleInput = document.getElementById('eventTitle');
      const newEventNameInput = document.getElementById('newEventNameInput');
      const addEventButton = document.getElementById('addEventButton');
      const clearInputsButton = document.getElementById('clearInputs');
      const eventTypeAllDay = document.getElementById('eventTypeAllDay');
      const eventTypeTimed = document.getElementById('eventTypeTimed');
      const timeInputsDiv = document.getElementById('timeInputs');
      const startTimeInput = document.getElementById('startTime');
      const endTimeInput = document.getElementById('endTime');
      const eventColorInput = document.getElementById('eventColor');
      const selectSavedEventName = document.getElementById('selectSavedEventName');
      const newEventEventTypeAllDay = document.getElementById('newEventEventTypeAllDay');
      const newEventEventTypeTimed = document.getElementById('newEventEventTypeTimed');
      const newStartTimeInput = document.getElementById('newStartTime');
      const newEndTimeInput = document.getElementById('newEndTime');
      const newEventColorInput = document.getElementById('newEventColor');
      const addEventNameButton = document.getElementById('addEventNameButton');
      const messageArea = document.getElementById('messageArea');
      const eventNamesListDiv = document.getElementById('eventNamesList');
      
      let selectedDays = new Set();
      let currentUserEmail = '';
      
      const today = new Date();
      const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
      monthInput.value = currentMonth;
      
      eventTypeAllDay.addEventListener('change', toggleTimeInputs);
      eventTypeTimed.addEventListener('change', toggleTimeInputs);
      newEventEventTypeAllDay.addEventListener('change', toggleNewEventTimeInputs);
      newEventEventTypeTimed.addEventListener('change', toggleNewEventTimeInputs);
      monthInput.addEventListener('change', updateDayGrid);
      
      toggleTimeInputs();
      toggleNewEventTimeInputs();
      updateDayGrid();
      
      google.script.run
        .withSuccessHandler(function(data) {
          currentUserEmail = data.userEmail;
          if (currentUserEmail) {
            calendarIdInput.value = currentUserEmail;
          }
          renderEventNames(data.eventNames);
        })
        .withFailureHandler(function(error) {
          console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—å¤±æ•—:', error.message);
          showMessage('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ', true);
        })
        .getCurrentUserEmailAndEventNames();
      
      selectSavedEventName.addEventListener('change', function() {
        const selectedValue = this.value;
        if (selectedValue) {
          google.script.run
            .withSuccessHandler(function(eventDetails) {
              if (eventDetails) {
                eventTitleInput.value = eventDetails.name;
                if (eventDetails.isAllDay) {
                  eventTypeAllDay.checked = true;
                } else {
                  eventTypeTimed.checked = true;
                }
                toggleTimeInputs();
                startTimeInput.value = eventDetails.startTime || '09:00';
                endTimeInput.value = eventDetails.endTime || '17:00';
                eventColorInput.value = eventDetails.eventColor || '';
                showMessage('âœ… ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', false);
              }
            })
            .withFailureHandler(function(error) {
              showMessage('âŒ èª­ã¿è¾¼ã¿å¤±æ•—: ' + error.message, true);
            })
            .getEventNameDetails(selectedValue);
        }
      });
      
      selectAllDaysButton.addEventListener('click', function() {
        const allDayButtons = dayGridDiv.querySelectorAll('button');
        const allSelected = allDayButtons.length === selectedDays.size;
        
        allDayButtons.forEach(button => {
          const day = button.dataset.day;
          if (allSelected) {
            button.classList.remove('selected');
            selectedDays.delete(day);
          } else {
            button.classList.add('selected');
            selectedDays.add(day);
          }
        });
      });
      
      function showMessage(message, isError = false) {
        messageArea.textContent = message;
        messageArea.className = isError ? 'message message-error' : 'message message-success';
        setTimeout(() => messageArea.classList.add('hidden'), 5000);
      }
      
      function renderEventNames(names) {
        selectSavedEventName.innerHTML = '<option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>';
        eventNamesListDiv.innerHTML = '';
        
        if (names && names.length > 0) {
          names.forEach(item => {
            const option = document.createElement('option');
            option.value = item.name;
            option.textContent = item.name;
            selectSavedEventName.appendChild(option);
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'event-item';
            const typeText = item.isAllDay ? 'çµ‚æ—¥' : `${item.startTime || '00:00'}-${item.endTime || '00:00'}`;
            const colorText = item.eventColor ? getColorEmoji(item.eventColor) : '';
            
            itemDiv.innerHTML = `
              <div class="event-info">
                <div class="event-name">${colorText} ${item.name}</div>
                <div class="event-details">${typeText}</div>
              </div>
              <button class="btn-delete" data-name="${item.name}">å‰Šé™¤</button>
            `;
            
            itemDiv.querySelector('button').addEventListener('click', function() {
              if (confirm('ã€Œ' + this.dataset.name + 'ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹?')) {
                deleteEventNameFromList(this.dataset.name);
              }
            });
            
            eventNamesListDiv.appendChild(itemDiv);
          });
        } else {
          eventNamesListDiv.innerHTML = '<p style="color: #999; font-size: 15px; text-align: center; padding: 20px;">ä¿å­˜æ¸ˆã¿ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        }
      }
      
      function getColorEmoji(color) {
        const colorMap = {
          'LAVENDER': 'ğŸŸ£', 'SAGE': 'ğŸŸ¢', 'PURPLE': 'ğŸŸ£', 'PINK': 'ğŸ©·',
          'YELLOW': 'ğŸŸ¡', 'ORANGE': 'ğŸŸ ', 'CYAN': 'ğŸ”µ', 'GREY': 'âšª',
          'BLUE': 'ğŸ”µ', 'GREEN': 'ğŸŸ¢', 'RED': 'ğŸ”´'
        };
        return colorMap[color] || '';
      }
      
      function addEventNameToList() {
        const newName = newEventNameInput.value.trim();
        if (!newName) {
          showMessage('âŒ ã‚¤ãƒ™ãƒ³ãƒˆåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', true);
          return;
        }
        
        const isAllDay = newEventEventTypeAllDay.checked;
        const startTime = newStartTimeInput.value;
        const endTime = newEndTimeInput.value;
        const eventColor = newEventColorInput.value;
        
        if (!isAllDay && (!startTime || !endTime)) {
          showMessage('âŒ é–‹å§‹ãƒ»çµ‚äº†æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', true);
          return;
        }
        
        showMessage('ä¿å­˜ä¸­...', false);
        google.script.run
          .withSuccessHandler(function(updatedNames) {
            renderEventNames(updatedNames);
            newEventNameInput.value = '';
            showMessage('âœ… ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ', false);
          })
          .withFailureHandler(function(error) {
            showMessage('âŒ ä¿å­˜å¤±æ•—: ' + error.message, true);
          })
          .addEventNames({
            name: newName,
            isAllDay: isAllDay,
            startTime: startTime,
            endTime: endTime,
            eventColor: eventColor
          });
      }
      
      function deleteEventNameFromList(nameToDelete) {
        google.script.run
          .withSuccessHandler(function(updatedNames) {
            renderEventNames(updatedNames);
            showMessage('âœ… å‰Šé™¤ã—ã¾ã—ãŸ', false);
          })
          .withFailureHandler(function(error) {
            showMessage('âŒ å‰Šé™¤å¤±æ•—: ' + error.message, true);
          })
          .deleteEventNameFromList(nameToDelete);
      }
      
      addEventNameButton.addEventListener('click', addEventNameToList);
      
      addEventButton.addEventListener('click', function() {
        const calendarId = calendarIdInput.value.trim();
        const month = monthInput.value;
        const eventTitle = eventTitleInput.value.trim();
        const isAllDay = eventTypeAllDay.checked;
        const startTime = startTimeInput.value;
        const endTime = endTimeInput.value;
        const eventColor = eventColorInput.value;
        
        if (!calendarId || !month || !eventTitle || selectedDays.size === 0) {
          showMessage('âŒ ã™ã¹ã¦å…¥åŠ›ã—ã¦æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„', true);
          return;
        }
        
        if (!isAllDay && (!startTime || !endTime)) {
          showMessage('âŒ é–‹å§‹ãƒ»çµ‚äº†æ™‚é–“ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', true);
          return;
        }
        
        const sortedDays = Array.from(selectedDays).sort((a, b) => Number(a) - Number(b));
        
        const originalText = addEventButton.textContent;
        addEventButton.innerHTML = 'ç™»éŒ²ä¸­...';
        addEventButton.disabled = true;
        
        google.script.run
          .withSuccessHandler(function(message) {
            showMessage('âœ… ' + message, false);
            addEventButton.textContent = originalText;
            addEventButton.disabled = false;
          })
          .withFailureHandler(function(error) {
            showMessage('âŒ ' + error.message, true);
            addEventButton.textContent = originalText;
            addEventButton.disabled = false;
          })
          .addEventsToCalendarDirectly(calendarId, month, sortedDays, eventTitle, isAllDay, startTime, endTime, eventColor);
      });
      
      clearInputsButton.addEventListener('click', function() {
        calendarIdInput.value = currentUserEmail;
        monthInput.value = currentMonth;
        eventTitleInput.value = '';
        newEventNameInput.value = '';
        eventTypeAllDay.checked = true;
        newEventEventTypeAllDay.checked = true;
        toggleTimeInputs();
        toggleNewEventTimeInputs();
        startTimeInput.value = '09:00';
        endTimeInput.value = '17:00';
        newStartTimeInput.value = '09:00';
        newEndTimeInput.value = '17:00';
        eventColorInput.value = '';
        newEventColorInput.value = '';
        selectSavedEventName.value = '';
        updateDayGrid();
        messageArea.classList.add('hidden');
        showMessage('âœ… ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', false);
      });
      
      function updateDayGrid() {
        dayGridDiv.innerHTML = '';
        selectedDays.clear();
        
        const [year, month] = monthInput.value.split('-').map(Number);
        if (isNaN(year) || isNaN(month)) {
          dayGridDiv.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #ff4757;">æœ‰åŠ¹ãªå¹´æœˆã‚’é¸æŠã—ã¦ãã ã•ã„</p>';
          return;
        }
        
        const daysInMonth = new Date(year, month, 0).getDate();
        const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
        
        dayNames.forEach(name => {
          const dayNameDiv = document.createElement('div');
          dayNameDiv.textContent = name;
          dayNameDiv.className = 'calendar-header';
          dayGridDiv.appendChild(dayNameDiv);
        });
        
        const firstDayOfMonth = new Date(year, month - 1, 1).getDay();
        
        for (let i = 0; i < firstDayOfMonth; i++) {
          const emptyDiv = document.createElement('div');
          dayGridDiv.appendChild(emptyDiv);
        }
        
        for (let i = 1; i <= daysInMonth; i++) {
          const button = document.createElement('button');
          button.textContent = i;
          button.className = 'calendar-day';
          button.dataset.day = i;
          button.addEventListener('click', function() {
            this.classList.toggle('selected');
            const day = this.dataset.day;
            if (this.classList.contains('selected')) {
              selectedDays.add(day);
            } else {
              selectedDays.delete(day);
            }
          });
          dayGridDiv.appendChild(button);
        }
      }
      
      function toggleTimeInputs() {
        timeInputsDiv.style.display = eventTypeTimed.checked ? 'block' : 'none';
      }
      
      function toggleNewEventTimeInputs() {
        document.getElementById('newEventNameInputs').style.display = 
          newEventEventTypeTimed.checked ? 'grid' : 'none';
      }
    });
  </script>
</body>
</html>
